<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PC Inventory Logger — Auth (HTML + JS)</title>

  <style>
    /* Simple, clean styling */
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --muted: #64748b;
      --accent: #0ea5e9;
      --danger: #ef4444;
      --radius: 10px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body { height: 100%; margin:0; background:var(--bg); color:#0f172a; }
    .wrap { min-height:100%; display:flex; align-items:center; justify-content:center; padding:24px; }
    .card {
      width:100%; max-width:720px; background:var(--card); border-radius:var(--radius); box-shadow:0 6px 18px rgba(2,6,23,0.08);
      padding:20px;
    }
    h1{ margin:0 0 6px; font-size:20px }
    p.lead{ margin:0 0 18px; color:var(--muted); font-size:13px }

    .grid { display:grid; gap:12px; grid-template-columns: 1fr 1fr; }
    @media (max-width:640px){ .grid{ grid-template-columns: 1fr } }

    label{ display:block; font-size:13px; color:var(--muted); margin-bottom:6px }
    input[type="email"], input[type="password"], input[type="text"]{
      width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e6eef5; outline:none;
      background:#fff; box-sizing:border-box;
    }
    .btn {
      display:inline-block; padding:10px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:600;
      background:var(--accent); color: white;
    }
    .btn.ghost { background:transparent; color:var(--muted); border:1px solid #e6eef5; font-weight:600; }
    .btn.danger { background:var(--danger); }

    .muted { color:var(--muted); font-size:13px }
    .error { color:var(--danger); font-size:13px; margin-top:6px }
    .success { color: #059669; font-size:13px; margin-top:6px }

    .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .spacer { height:12px; width:100% }

    .hidden { display:none !important; }

    .inventory {
      border-top:1px dashed #e6eef5; padding-top:12px; margin-top:12px;
    }

    small.code { background:#f1f5f9; padding:2px 6px; border-radius:6px; font-family:monospace; font-size:12px }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app">
      <div id="auth-area">
        <h1>PC Inventory Logger</h1>
        <p class="lead">Sign up or sign in to save and sync your parts online.</p>

        <div id="modes" class="row" style="margin-bottom:12px;">
          <button class="btn" id="btn-login-mode">Sign in</button>
          <button class="btn ghost" id="btn-signup-mode">Create account</button>
          <button class="btn ghost" id="btn-reset-mode">Reset password</button>
        </div>

        <form id="auth-form">
          <div class="grid">
            <div>
              <label for="email">Email</label>
              <input id="email" type="email" placeholder="you@example.com" required />
            </div>
            <div id="password-field">
              <label for="password">Password</label>
              <input id="password" type="password" placeholder="At least 6 characters" />
            </div>
          </div>

        <div id="confirm-field" class="hidden">
            <label for="confirm">Confirm password</label>
            <input id="confirm" type="password" placeholder="Confirm password" />
        </div>


          <div class="spacer"></div>

          <div class="row">
            <button id="submit-btn" class="btn">Sign in</button>
            <button id="clear-btn" type="button" class="btn ghost">Clear</button>
            <div id="status" class="muted" style="margin-left:auto"></div>
          </div>

          <div id="error" class="error hidden"></div>
          <div id="success" class="success hidden"></div>
        </form>
      </div>

      <div id="user-area" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <h1 id="welcome">Welcome</h1>
            <div class="muted">Signed in as <span id="user-email" class="code"></span></div>
            <div class="muted">UID: <small class="code" id="user-uid"></small></div>
          </div>
          <div class="row">
            <button id="signout-btn" class="btn ghost">Sign out</button>
          </div>
        </div>

        <div class="inventory">
          <h3 style="margin-top:8px; margin-bottom:6px">Inventory (placeholder)</h3>
          <p class="muted">Replace this block with your inventory UI. Save items under <code class="code">users/{uid}/parts</code> in Firestore.</p>

          <!-- Simple add form as example -->
          <div style="margin-top:12px">
            <div class="grid" style="align-items:center;">
              <div>
                <label for="part-name">Part name</label>
                <input id="part-name" type="text" placeholder="RTX 3060" />
              </div>
              <div>
                <label for="part-price">Unit price (USD)</label>
                <input id="part-price" type="text" placeholder="350.00" />
              </div>
            </div>

            <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
              <button id="save-part" class="btn">Save part (demo)</button>
              <div id="save-status" class="muted"></div>
            </div>

            <div id="parts-list" style="margin-top:12px"></div>
          </div>
        </div>
      </div>
  </div>

  <!-- Firebase v9 modular SDK (CDN). Versions can be updated later. -->
  <script type="module">
    // Import Firebase modules from CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      sendPasswordResetEmail,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import {
      getFirestore,
      collection,
      addDoc,
      query,
      orderBy,
      onSnapshot,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // --- REPLACE with your own firebaseConfig if different ---
    const firebaseConfig = {
      apiKey: "AIzaSyAyI8tR4Piubfchvvb39d8u6Qx1XXAnK2Q",
      authDomain: "pclogr.firebaseapp.com",
      projectId: "pclogr",
      storageBucket: "pclogr.firebasestorage.app",
      messagingSenderId: "365874402726",
      appId: "1:365874402726:web:9c2ab934b98da538a3ab67",
      measurementId: "G-KZHPPKXQ92"
    };

    // init firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // elements
    const modeButtons = {
      login: document.getElementById('btn-login-mode'),
      signup: document.getElementById('btn-signup-mode'),
      reset: document.getElementById('btn-reset-mode'),
    };
    const emailEl = document.getElementById('email');
    const passwordEl = document.getElementById('password');
    const confirmEl = document.getElementById('confirm');
    const passwordField = document.getElementById('password-field');
    const confirmField = document.getElementById('confirm-field');
    const submitBtn = document.getElementById('submit-btn');
    const clearBtn = document.getElementById('clear-btn');
    const errorEl = document.getElementById('error');
    const successEl = document.getElementById('success');
    const statusEl = document.getElementById('status');

    const authArea = document.getElementById('auth-area');
    const userArea = document.getElementById('user-area');
    const userEmailEl = document.getElementById('user-email');
    const userUidEl = document.getElementById('user-uid');
    const welcomeEl = document.getElementById('welcome');
    const signoutBtn = document.getElementById('signout-btn');

    // demo inventory elements
    const partName = document.getElementById('part-name');
    const partPrice = document.getElementById('part-price');
    const savePartBtn = document.getElementById('save-part');
    const saveStatus = document.getElementById('save-status');
    const partsList = document.getElementById('parts-list');

    let currentMode = 'login'; // login | signup | reset
    function setMode(mode) {
        currentMode = mode;
        submitBtn.textContent = mode === 'signup' ? 'Create account' : mode === 'reset' ? 'Send reset' : 'Sign in';
        passwordField.style.display = mode === 'reset' ? 'none' : 'block';
        confirmField.classList.toggle('hidden', mode !== 'signup');
        updateModeButtons(mode);   // <--- use this
        clearMessages();
    }

    function updateModeButtons(mode) {
        // Mode: 'login' | 'signup' | 'reset'
        if (mode === 'login') {
            modeButtons.login.className = 'btn';
            modeButtons.signup.className = 'btn ghost';
            modeButtons.reset.className = 'btn ghost';
        } else if (mode === 'signup') {
            modeButtons.login.className = 'btn ghost';
            modeButtons.signup.className = 'btn';
            modeButtons.reset.className = 'btn ghost';
        } else {
            modeButtons.login.className = 'btn ghost';
            modeButtons.signup.className = 'btn ghost';
            modeButtons.reset.className = 'btn';
        }
    }



    function clearMessages() {
      errorEl.classList.add('hidden'); successEl.classList.add('hidden');
      errorEl.textContent = ''; successEl.textContent = ''; statusEl.textContent = '';
    }

    function showError(msg) {
      errorEl.textContent = msg; errorEl.classList.remove('hidden'); successEl.classList.add('hidden');
    }
    function showSuccess(msg) {
      successEl.textContent = msg; successEl.classList.remove('hidden'); errorEl.classList.add('hidden');
    }

    modeButtons.login.addEventListener('click', () => setMode('login'));
    modeButtons.signup.addEventListener('click', () => setMode('signup'));
    modeButtons.reset.addEventListener('click', () => setMode('reset'));

    clearBtn.addEventListener('click', () => {
      emailEl.value = ''; passwordEl.value = ''; confirmEl.value = ''; clearMessages();
    });

    // handle auth form submit
    document.getElementById('auth-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      clearMessages();
      const email = emailEl.value.trim();
      const password = passwordEl.value;
      if (!email) return showError('Enter an email.');

      try {
        if (currentMode === 'signup') {
          if (!password) return showError('Enter a password.');
          if (password !== confirmEl.value) return showError('Passwords do not match.');
          submitBtn.disabled = true; statusEl.textContent = 'Creating account…';
          await createUserWithEmailAndPassword(auth, email, password);
          showSuccess('Account created — signed in.');
        } else if (currentMode === 'login') {
          if (!password) return showError('Enter your password.');
          submitBtn.disabled = true; statusEl.textContent = 'Signing in…';
          await signInWithEmailAndPassword(auth, email, password);
          showSuccess('Signed in.');
        } else if (currentMode === 'reset') {
          submitBtn.disabled = true; statusEl.textContent = 'Sending reset email…';
          await sendPasswordResetEmail(auth, email);
          showSuccess('Password reset email sent — check your inbox.');
        }
      } catch (err) {
        showError(err.message || 'Auth error');
      } finally {
        submitBtn.disabled = false; statusEl.textContent = '';
      }
    });

    // auth state listener
    let partsUnsub = null;
    onAuthStateChanged(auth, (user) => {
      clearMessages();
      if (user) {
        // show protected UI
        authArea.classList.add('hidden');
        userArea.classList.remove('hidden');
        userEmailEl.textContent = user.email;
        userUidEl.textContent = user.uid;
        welcomeEl.textContent = `Welcome, ${user.email}`;

        // start realtime listener for user's parts (demo)
        const partsCol = collection(db, 'users', user.uid, 'parts');
        const q = query(partsCol, orderBy('createdAt', 'desc'));
        if (partsUnsub) partsUnsub();
        partsUnsub = onSnapshot(q, (snap) => {
          partsList.innerHTML = ''; // simple render
          if (snap.empty) {
            partsList.innerHTML = '<div class="muted">No parts saved yet.</div>';
            return;
          }
          snap.forEach(doc => {
            const data = doc.data();
            const container = document.createElement('div');
            container.style.borderBottom = '1px solid #eef5fb';
            container.style.padding = '8px 0';
            container.innerHTML = `<strong>${escapeHtml(data.name || '(no name)')}</strong>
              <div class="muted">Qty: ${data.qty || 1} • $${Number(data.price || 0).toFixed(2)} • ${new Date((data.createdAt && data.createdAt.seconds ? data.createdAt.seconds*1000 : Date.now())).toLocaleString()}</div>`;
            partsList.appendChild(container);
          });
        }, (err) => {
          partsList.innerHTML = '<div class="error">Failed to load parts.</div>';
        });

      } else {
        // show auth UI
        authArea.classList.remove('hidden');
        userArea.classList.add('hidden');
        if (partsUnsub) { partsUnsub(); partsUnsub = null; }
      }
    });

    signoutBtn.addEventListener('click', async () => {
      await signOut(auth);
    });

    // demo: save part to Firestore under users/{uid}/parts
    savePartBtn.addEventListener('click', async () => {
      saveStatus.textContent = ''; clearMessages();
      const user = auth.currentUser;
      if (!user) return showError('Not signed in.');
      const name = partName.value.trim();
      const price = parseFloat((partPrice.value || '').replace(/[^0-9.\-]/g, '')) || 0;
      if (!name) return showError('Enter a part name.');
      savePartBtn.disabled = true; saveStatus.textContent = 'Saving…';
      try {
        await addDoc(collection(db, 'users', user.uid, 'parts'), {
          name,
          price,
          qty: 1,
          vendor: '',
          createdAt: serverTimestamp()
        });
        partName.value = ''; partPrice.value = '';
        saveStatus.textContent = 'Saved.';
        setTimeout(()=>saveStatus.textContent='', 2000);
      } catch (err) {
        showError(err.message || 'Save failed');
      } finally {
        savePartBtn.disabled = false;
      }
    });

    // small helper
    function escapeHtml(str) {
      return String(str || '').replace(/[&<>"']/g, function(m) {
        return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m];
      });
    }

    // default initial mode
    setMode('login');
  </script>
</body>
</html>
